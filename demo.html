<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–èŠå¤©æµ‹è¯•</title>
    
    <!-- èŠå¤©æ ·å¼ -->
    <link rel="stylesheet" href="/src/styles/chat.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            background: #667eea;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .controls {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover { background: #5a6fd8; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        
        .status {
            margin-left: auto;
            font-weight: bold;
        }
        
        #chat-container {
            height: 500px;
        }
        
        .scene-chat-container {
            height: 100% !important;
            display: block !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’¬ ç®€åŒ–èŠå¤©åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•åŸºæœ¬çš„WebSocketèŠå¤©åŠŸèƒ½</p>
        </div>
        
        <div class="controls">
            <select id="template-select">
                <option value="1">å¿ƒçµæ‘†æ¸¡äººçš„å¯ç¨‹</option>
                <option value="2">æ²»æ„ˆä¹‹æ¸¯çš„å®ˆæŠ¤è€…</option>
                <option value="3">æƒ…æ„Ÿä¹‹å²›çš„é•œåƒç²¾çµ</option>
            </select>
            <button class="btn" onclick="startChat()">å¼€å§‹èŠå¤©</button>
            <button class="btn" onclick="testMessage()">æµ‹è¯•æ¶ˆæ¯</button>
            <div class="status" id="status">æœªè¿æ¥</div>
        </div>
        
        <div id="chat-container">
            <!-- èŠå¤©ç•Œé¢å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
        </div>
    </div>

    <script type="module">
        import { chatManager } from './src/components/ChatManager.js';
        import { wsClient, WebSocketEvents } from './src/services/WebSocketClient.js';

        // çŠ¶æ€æ›´æ–°
        function updateStatus(text, color = '#333') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.style.color = color;
        }

        // ç›‘å¬WebSocketäº‹ä»¶
        wsClient.on(WebSocketEvents.CONNECTED, () => {
            updateStatus('è¿æ¥ä¸­...', '#FFA500');
        });

        wsClient.on(WebSocketEvents.SESSION_CREATED, (data) => {
            updateStatus('å·²è¿æ¥', '#4CAF50');
            console.log('ä¼šè¯åˆ›å»ºæˆåŠŸ:', data);
        });

        wsClient.on(WebSocketEvents.ERROR, (data) => {
            updateStatus('è¿æ¥é”™è¯¯', '#F44336');
            console.error('WebSocketé”™è¯¯:', data);
        });

        wsClient.on(WebSocketEvents.DISCONNECTED, () => {
            updateStatus('å·²æ–­å¼€', '#757575');
        });

        // å…¨å±€å‡½æ•°
        window.startChat = function() {
            const templateId = parseInt(document.getElementById('template-select').value);
            console.log('å¼€å§‹èŠå¤©ï¼Œæ¨¡æ¿ID:', templateId);
            
            updateStatus('åˆå§‹åŒ–ä¸­...', '#FFA500');
            
            try {
                chatManager.initChatInterface('chat-container', templateId);
                console.log('èŠå¤©ç•Œé¢åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('åˆå§‹åŒ–å¤±è´¥', '#F44336');
            }
        };

        window.testMessage = function() {
            if (!chatManager.inputElement) {
                alert('è¯·å…ˆå¼€å§‹èŠå¤©');
                return;
            }
            
            const testMessage = "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ã€‚";
            chatManager.inputElement.value = testMessage;
            chatManager.sendMessage();
        };

        console.log('é¡µé¢åŠ è½½å®Œæˆ');
        updateStatus('ç‚¹å‡»"å¼€å§‹èŠå¤©"', '#666');
    </script>
</body>
</html>